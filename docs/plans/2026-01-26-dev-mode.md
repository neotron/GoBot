# Development Mode Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Add configuration options to disable flight log posting and filter which slash commands are registered, for easier development and testing.

**Architecture:** Two independent config flags - `disableFlightLogs` (bool) and `slashCommandAllowlist` (string array). Empty/missing values preserve current behavior.

**Tech Stack:** Go, existing settings infrastructure

---

## Task 1: Add Configuration Options

**Files:**
- Modify: `core/settings.go`

**Step 1: Add fields to jsonData struct**

After `FollowerDistanceThreshold`, add:

```go
DisableFlightLogs     bool     // When true, don't post carrier updates to Discord
SlashCommandAllowlist []string // When non-empty, only register these slash commands
```

**Step 2: Add accessor methods**

```go
// DisableFlightLogs returns whether flight log posting is disabled
func (s *SettingsStorage) DisableFlightLogs() bool {
	return s.data.DisableFlightLogs
}

// SlashCommandAllowlist returns the list of allowed slash commands (empty = all allowed)
func (s *SettingsStorage) SlashCommandAllowlist() []string {
	return s.data.SlashCommandAllowlist
}
```

**Step 3: Verify build**

Run: `go build ./...`
Expected: No errors

**Step 4: Commit**

```bash
git add core/settings.go
git commit -m "feat: add disableFlightLogs and slashCommandAllowlist config options"
```

---

## Task 2: Add Flight Log Disable Check

**Files:**
- Modify: `core/services/carriers.go`

**Step 1: Add early return in PostCarrierFlightLog**

At the start of `PostCarrierFlightLog` function, before the existing `channelId` check, add:

```go
if core.Settings.DisableFlightLogs() {
	return
}
```

**Step 2: Add startup logging in LoadSettings or after settings loaded**

In `core/settings.go`, at the end of `LoadSettings()`, add:

```go
if Settings.data.DisableFlightLogs {
	LogInfo("Flight logs disabled (disableFlightLogs=true)")
}
```

**Step 3: Verify build**

Run: `go build ./...`
Expected: No errors

**Step 4: Commit**

```bash
git add core/services/carriers.go core/settings.go
git commit -m "feat: implement disableFlightLogs check"
```

---

## Task 3: Add Slash Command Allowlist Filter

**Files:**
- Modify: `core/dispatch/handlers/carriers_slash.go`

**Step 1: Find the command registration function**

Look for where `allCommands` is built and registered (around line 172).

**Step 2: Add filtering logic after allCommands is built**

After `allCommands := append(carrierSlashCommands, GetEliteDangerousSlashCommands()...)`, add:

```go
// Filter commands if allowlist is configured
allowlist := core.Settings.SlashCommandAllowlist()
if len(allowlist) > 0 {
	allowlistMap := make(map[string]bool)
	for _, name := range allowlist {
		allowlistMap[name] = true
	}
	filtered := make([]*discordgo.ApplicationCommand, 0)
	for _, cmd := range allCommands {
		if allowlistMap[cmd.Name] {
			filtered = append(filtered, cmd)
		}
	}
	core.LogInfoF("Slash command allowlist active: %v (registering %d of %d commands)", allowlist, len(filtered), len(allCommands))
	allCommands = filtered
}
```

**Step 3: Verify build**

Run: `go build ./...`
Expected: No errors

**Step 4: Commit**

```bash
git add core/dispatch/handlers/carriers_slash.go
git commit -m "feat: implement slash command allowlist filtering"
```

---

## Task 4: Integration Test

**Step 1: Update dev config**

Add to your `config-dev.json`:

```json
"disableFlightLogs": true,
"slashCommandAllowlist": ["followers", "carrierinfo"]
```

**Step 2: Build and verify startup logs**

Run: `go build -o gobot . && ./gobot -c config-dev.json`

Expected log output should include:
- `Flight logs disabled (disableFlightLogs=true)`
- `Slash command allowlist active: [followers carrierinfo] (registering 2 of N commands)`

**Step 3: Verify only allowlisted commands appear in Discord**

Check that only `/followers` and `/carrierinfo` are available, not `/carriers`, `/carrierjump`, etc.

---

## Summary

**New Config Options:**
- `disableFlightLogs` (bool) - When true, `PostCarrierFlightLog` returns immediately
- `slashCommandAllowlist` ([]string) - When non-empty, only register named commands

**Behavior:**
- Empty/missing values = current behavior (logs enabled, all commands registered)
- Startup logs indicate when dev features are active
